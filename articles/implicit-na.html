<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handle implicit missingness with tsibble • tsibble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Handle implicit missingness with tsibble">
<meta property="og:description" content="tsibble">
<meta property="og:image" content="https://tsibble.tidyverts.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-83007123-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-83007123-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tsibble</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-tsibble.html">Introduction to tsibble</a>
    </li>
    <li>
      <a href="../articles/implicit-na.html">Handle implicit missingess with tsibble</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tidyverts/tsibble">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="implicit-na_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Handle implicit missingness with tsibble</h1>
                        <h4 class="author">Earo Wang</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverts/tsibble/blob/master/vignettes/implicit-na.Rmd"><code>vignettes/implicit-na.Rmd</code></a></small>
      <div class="hidden name"><code>implicit-na.Rmd</code></div>

    </div>

    
    
<p>Assuming you have <a href="https://pkg.earo.me/tsibble/articles/intro-tsibble.html">set up a tsibble</a>, you are ready for undertaking analysis in temporal context. Many time operations, such as lag and lead, assume an intact vector input ordered in time. To avoid inviting these errors into the analysis, it is a good practice to inspect any <strong>implicit missingness</strong> of the tsibble before analysis. A handful of tools are provided to understand and tackle missing values: (1) <code><a href="../reference/has_gaps.html">has_gaps()</a></code> checks if there exists implicit missingness; (2) <code><a href="../reference/scan_gaps.html">scan_gaps()</a></code> reports all implicit missing entries; (3) <code><a href="../reference/count_gaps.html">count_gaps()</a></code> summarises the time ranges that are absent from the data; (4) <code><a href="../reference/fill_gaps.html">fill_gaps()</a></code> turns them into explicit ones, along with imputing by values or functions. These functions have a common argument <code>.full</code>. If <code>FALSE</code> (default) looks into the time period for each key, otherwise the full-length time span. The <code>pedestrian</code> data contains hourly tallies of pedestrians at four counting sensors in 2015 and 2016 in inner Melbourne.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tsibble</span>)
<span class="no">pedestrian</span></pre></body></html></div>
<pre><code>#&gt; # A tsibble: 66,037 x 5 [1h] &lt;Australia/Melbourne&gt;
#&gt; # Key:       Sensor [4]
#&gt;   Sensor         Date_Time           Date        Time Count
#&gt;   &lt;chr&gt;          &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;int&gt;
#&gt; 1 Birrarung Marr 2015-01-01 00:00:00 2015-01-01     0  1630
#&gt; 2 Birrarung Marr 2015-01-01 01:00:00 2015-01-01     1   826
#&gt; 3 Birrarung Marr 2015-01-01 02:00:00 2015-01-01     2   567
#&gt; 4 Birrarung Marr 2015-01-01 03:00:00 2015-01-01     3   264
#&gt; 5 Birrarung Marr 2015-01-01 04:00:00 2015-01-01     4   139
#&gt; # … with 66,032 more rows</code></pre>
<p>Indeed each sensor has gaps in time.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/has_gaps.html">has_gaps</a></span>(<span class="no">pedestrian</span>, <span class="kw">.full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>#&gt; # A tibble: 4 x 2
#&gt;   Sensor                        .gaps
#&gt;   &lt;chr&gt;                         &lt;lgl&gt;
#&gt; 1 Birrarung Marr                TRUE 
#&gt; 2 Bourke Street Mall (North)    TRUE 
#&gt; 3 QV Market-Elizabeth St (West) TRUE 
#&gt; 4 Southern Cross Station        TRUE</code></pre>
<p>So where are these gaps? <code><a href="../reference/scan_gaps.html">scan_gaps()</a></code> gives a detailed report of missing observations. <code><a href="../reference/count_gaps.html">count_gaps()</a></code> presents a summarised table about the individual time gap alongside the number of missing observations for each key. It is clear that Birrarung Marr exhibits many chunks of missingness, while Bourke Street Mall (North) displays as many consecutive missingness as 1128. If <code>.full = FALSE</code>, the opening gap for Bourke Street Mall (North) will not be recognised.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ped_gaps</span> <span class="kw">&lt;-</span> <span class="no">pedestrian</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/count_gaps.html">count_gaps</a></span>(<span class="kw">.full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ped_gaps</span></pre></body></html></div>
<pre><code>#&gt; # A tibble: 19 x 4
#&gt;    Sensor                        .from               .to                    .n
#&gt;    &lt;chr&gt;                         &lt;dttm&gt;              &lt;dttm&gt;              &lt;int&gt;
#&gt;  1 Birrarung Marr                2015-04-05 02:00:00 2015-04-05 02:00:00     1
#&gt;  2 Birrarung Marr                2015-05-07 00:00:00 2015-05-31 23:00:00   600
#&gt;  3 Birrarung Marr                2015-10-06 00:00:00 2015-10-31 23:00:00   624
#&gt;  4 Birrarung Marr                2015-11-05 00:00:00 2015-11-06 23:00:00    48
#&gt;  5 Birrarung Marr                2015-11-20 00:00:00 2015-11-24 23:00:00   120
#&gt;  6 Birrarung Marr                2015-11-26 00:00:00 2015-12-04 23:00:00   216
#&gt;  7 Birrarung Marr                2016-04-03 02:00:00 2016-04-03 02:00:00     1
#&gt;  8 Birrarung Marr                2016-04-08 00:00:00 2016-05-03 23:00:00   624
#&gt;  9 Birrarung Marr                2016-10-29 00:00:00 2016-11-28 23:00:00   744
#&gt; 10 Bourke Street Mall (North)    2015-01-01 00:00:00 2015-02-16 23:00:00  1128
#&gt; 11 Bourke Street Mall (North)    2015-04-05 02:00:00 2015-04-05 02:00:00     1
#&gt; 12 Bourke Street Mall (North)    2016-04-03 02:00:00 2016-04-03 02:00:00     1
#&gt; 13 QV Market-Elizabeth St (West) 2015-04-05 02:00:00 2015-04-05 02:00:00     1
#&gt; 14 QV Market-Elizabeth St (West) 2015-12-31 00:00:00 2015-12-31 23:00:00    24
#&gt; 15 QV Market-Elizabeth St (West) 2016-04-03 02:00:00 2016-04-03 02:00:00     1
#&gt; 16 Southern Cross Station        2015-04-05 02:00:00 2015-04-05 02:00:00     1
#&gt; 17 Southern Cross Station        2016-03-08 02:00:00 2016-03-08 02:00:00     1
#&gt; 18 Southern Cross Station        2016-03-29 02:00:00 2016-03-29 03:00:00     2
#&gt; 19 Southern Cross Station        2016-04-03 02:00:00 2016-04-03 02:00:00     1</code></pre>
<p>These gaps can be visually presented using <strong>ggplot2</strong> as follows. There are two points popping out to us at all sensors, probably due to the fact that the system skipped the extra hour when switching from daylight savings to standard time.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">ped_gaps</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Sensor</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">Sensor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">.from</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">.to</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">.from</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">.to</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="implicit-na_files/figure-html/ggplot-gaps-1.png" width="672"></p>
<p>We have learned if any missing periods and where, and we enlarge the tsibble to include explicit <code>NA</code> (previously as implicit missingness). The function <code><a href="../reference/fill_gaps.html">fill_gaps()</a></code> takes care of filling the key and index, and leaves other variables filled by the default <code>NA</code>. The <code>pedestrian</code> data initially contains 66037 and gets augmented to 70176.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ped_full</span> <span class="kw">&lt;-</span> <span class="no">pedestrian</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/fill_gaps.html">fill_gaps</a></span>(<span class="kw">.full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ped_full</span></pre></body></html></div>
<pre><code>#&gt; # A tsibble: 70,176 x 5 [1h] &lt;Australia/Melbourne&gt;
#&gt; # Key:       Sensor [4]
#&gt;   Sensor         Date_Time           Date        Time Count
#&gt;   &lt;chr&gt;          &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;int&gt;
#&gt; 1 Birrarung Marr 2015-01-01 00:00:00 2015-01-01     0  1630
#&gt; 2 Birrarung Marr 2015-01-01 01:00:00 2015-01-01     1   826
#&gt; 3 Birrarung Marr 2015-01-01 02:00:00 2015-01-01     2   567
#&gt; 4 Birrarung Marr 2015-01-01 03:00:00 2015-01-01     3   264
#&gt; 5 Birrarung Marr 2015-01-01 04:00:00 2015-01-01     4   139
#&gt; # … with 70,171 more rows</code></pre>
<p>Other than <code>NA</code>, a set of name-value pairs goes along with <code><a href="../reference/fill_gaps.html">fill_gaps()</a></code>, by imputing values or functions as desired.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">pedestrian</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/fill_gaps.html">fill_gaps</a></span>(<span class="kw">Count</span> <span class="kw">=</span> <span class="fl">0L</span>, <span class="kw">.full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">pedestrian</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/group_by_key.html">group_by_key</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/fill_gaps.html">fill_gaps</a></span>(<span class="kw">Count</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">Count</span>), <span class="kw">.full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://earo.me">Earo Wang</a>, <a href="http://dicook.org">Di Cook</a>, <a href="http://robjhyndman.com">Rob Hyndman</a>, <a href="http://mitchelloharawild.com">Mitchell O'Hara-Wild</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'b7cf533da009fba6bd7a07d530e0824e',
    indexName: 'tsibble',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
